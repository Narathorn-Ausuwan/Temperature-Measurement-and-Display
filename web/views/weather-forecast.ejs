<!DOCTYPE html>
<html lang="th">

<head>
  <meta charset="UTF-8" />
  <title>‡∏û‡∏¢‡∏≤‡∏Å‡∏£‡∏ì‡πå‡∏≠‡∏≤‡∏Å‡∏≤‡∏® 7 ‡∏ß‡∏±‡∏ô + ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á (Open-Meteo)</title>
  <link rel="stylesheet" href="/css/forecast.css">
</head>

<body>

  <div class="container">
    <h2>üå§ ‡∏û‡∏¢‡∏≤‡∏Å‡∏£‡∏ì‡πå‡∏≠‡∏≤‡∏Å‡∏≤‡∏®‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤ 7 ‡∏ß‡∏±‡∏ô</h2>
    <label>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î</label>
    <select id="provinceSelect"></select>

    <button onclick="getWeather()">‡πÅ‡∏™‡∏î‡∏á‡∏û‡∏¢‡∏≤‡∏Å‡∏£‡∏ì‡πå</button>

    <div id="weekContainer" class="week-container"></div>
    <div id="summaryContainer"></div>
    <div id="hourlyContainer"></div>
  </div>

  <script>

    const provinces = {
    "‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏°‡∏´‡∏≤‡∏ô‡∏Ñ‡∏£": { lat: 13.7563, lon: 100.5018 },
    "‡∏Å‡∏£‡∏∞‡∏ö‡∏µ‡πà": { lat: 8.0863, lon: 98.9063 },
    "‡∏Å‡∏≤‡∏ç‡∏à‡∏ô‡∏ö‡∏∏‡∏£‡∏µ": { lat: 14.0228, lon: 99.5328 },
    "‡∏Å‡∏≤‡∏¨‡∏™‡∏¥‡∏ô‡∏ò‡∏∏‡πå": { lat: 16.4314, lon: 103.5059 },
    "‡∏Å‡∏≥‡πÅ‡∏û‡∏á‡πÄ‡∏û‡∏ä‡∏£": { lat: 16.4828, lon: 99.5227 },
    "‡∏Ç‡∏≠‡∏ô‡πÅ‡∏Å‡πà‡∏ô": { lat: 16.4419, lon: 102.8350 },
    "‡∏à‡∏±‡∏ô‡∏ó‡∏ö‡∏∏‡∏£‡∏µ": { lat: 12.6113, lon: 102.1039 },
    "‡∏â‡∏∞‡πÄ‡∏ä‡∏¥‡∏á‡πÄ‡∏ó‡∏£‡∏≤": { lat: 13.6904, lon: 101.0780 },
    "‡∏ä‡∏•‡∏ö‡∏∏‡∏£‡∏µ": { lat: 13.3611, lon: 100.9847 },
    "‡∏ä‡∏±‡∏¢‡∏ô‡∏≤‡∏ó": { lat: 15.1852, lon: 100.1251 },
    "‡∏ä‡∏±‡∏¢‡∏†‡∏π‡∏°‡∏¥": { lat: 15.8068, lon: 102.0315 },
    "‡∏ä‡∏∏‡∏°‡∏û‡∏£": { lat: 10.4930, lon: 99.1800 },
    "‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡∏£‡∏≤‡∏¢": { lat: 19.9072, lon: 99.8309 },
    "‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà": { lat: 18.7883, lon: 98.9853 },
    "‡∏ï‡∏£‡∏±‡∏á": { lat: 7.5594, lon: 99.6110 },
    "‡∏ï‡∏£‡∏≤‡∏î": { lat: 12.2427, lon: 102.5174 },
    "‡∏ï‡∏≤‡∏Å": { lat: 16.8839, lon: 99.1258 },
    "‡∏ô‡∏Ñ‡∏£‡∏ô‡∏≤‡∏¢‡∏Å": { lat: 14.2069, lon: 101.2130 },
    "‡∏ô‡∏Ñ‡∏£‡∏õ‡∏ê‡∏°": { lat: 13.8199, lon: 100.0621 },
    "‡∏ô‡∏Ñ‡∏£‡∏û‡∏ô‡∏°": { lat: 17.3920, lon: 104.7695 },
    "‡∏ô‡∏Ñ‡∏£‡∏£‡∏≤‡∏ä‡∏™‡∏µ‡∏°‡∏≤": { lat: 14.9798, lon: 102.0977 },
    "‡∏ô‡∏Ñ‡∏£‡∏®‡∏£‡∏µ‡∏ò‡∏£‡∏£‡∏°‡∏£‡∏≤‡∏ä": { lat: 8.43039, lon: 99.9631 },
    "‡∏ô‡∏Ñ‡∏£‡∏™‡∏ß‡∏£‡∏£‡∏Ñ‡πå": { lat: 15.6930, lon: 100.1225 },
    "‡∏ô‡∏ô‡∏ó‡∏ö‡∏∏‡∏£‡∏µ": { lat: 13.8621, lon: 100.5143 },
    "‡∏ô‡∏£‡∏≤‡∏ò‡∏¥‡∏ß‡∏≤‡∏™": { lat: 6.4254, lon: 101.8253 },
    "‡∏ô‡πà‡∏≤‡∏ô": { lat: 18.7756, lon: 100.7730 },
    "‡∏ö‡∏∏‡∏£‡∏µ‡∏£‡∏±‡∏°‡∏¢‡πå": { lat: 14.9930, lon: 103.1029 },
    "‡∏õ‡∏ó‡∏∏‡∏°‡∏ò‡∏≤‡∏ô‡∏µ": { lat: 14.0208, lon: 100.5250 },
    "‡∏õ‡∏£‡∏∞‡∏à‡∏ß‡∏ö‡∏Ñ‡∏µ‡∏£‡∏µ‡∏Ç‡∏±‡∏ô‡∏ò‡πå": { lat: 11.8123, lon: 99.7973 },
    "‡∏õ‡∏£‡∏≤‡∏à‡∏µ‡∏ô‡∏ö‡∏∏‡∏£‡∏µ": { lat: 14.0509, lon: 101.3727 },
    "‡∏õ‡∏±‡∏ï‡∏ï‡∏≤‡∏ô‡∏µ": { lat: 6.8694, lon: 101.2504 },
    "‡∏û‡∏£‡∏∞‡∏ô‡∏Ñ‡∏£‡∏®‡∏£‡∏µ‡∏≠‡∏¢‡∏∏‡∏ò‡∏¢‡∏≤": { lat: 14.3532, lon: 100.5689 },
    "‡∏û‡∏∞‡πÄ‡∏¢‡∏≤": { lat: 19.1664, lon: 99.9019 },
    "‡∏û‡∏±‡∏á‡∏á‡∏≤": { lat: 8.4407, lon: 98.5193 },
    "‡∏û‡∏±‡∏ó‡∏•‡∏∏‡∏á": { lat: 7.6166, lon: 100.0740 },
    "‡∏û‡∏¥‡∏à‡∏¥‡∏ï‡∏£:": { lat: 16.4429, lon: 100.3482 },
    "‡∏û‡∏¥‡∏©‡∏ì‡∏∏‡πÇ‡∏•‡∏Å": { lat: 16.8298, lon: 100.2614 },
    "‡πÄ‡∏û‡∏ä‡∏£‡∏ö‡∏∏‡∏£‡∏µ": { lat: 13.1111, lon: 99.9391 },
    "‡πÄ‡∏û‡∏ä‡∏£‡∏ö‡∏π‡∏£‡∏ì‡πå": { lat: 16.4189, lon: 101.1550 },
    "‡πÅ‡∏û‡∏£‡πà": { lat: 18.1445, lon: 100.1402 },
    "‡∏†‡∏π‡πÄ‡∏Å‡πá‡∏ï": { lat: 7.9810, lon: 98.3638 },
    "‡∏°‡∏´‡∏≤‡∏™‡∏≤‡∏£‡∏Ñ‡∏≤‡∏°": { lat: 16.1850, lon: 103.3026 },
    "‡∏°‡∏∏‡∏Å‡∏î‡∏≤‡∏´‡∏≤‡∏£": { lat: 16.5424, lon: 104.7209 },
    "‡πÅ‡∏°‡πà‡∏Æ‡πà‡∏≠‡∏á‡∏™‡∏≠‡∏ô": { lat: 19.2990, lon: 97.9656 },
    "‡∏¢‡πÇ‡∏™‡∏ò‡∏£": { lat: 15.7926, lon: 104.1452 },
    "‡∏¢‡∏∞‡∏•‡∏≤": { lat: 6.5411, lon: 101.2803 },
    "‡∏£‡πâ‡∏≠‡∏¢‡πÄ‡∏≠‡πá‡∏î": { lat: 16.0538, lon: 103.6520 },
    "‡∏£‡∏∞‡∏ô‡∏≠‡∏á": { lat: 9.9528, lon: 98.6084 },
    "‡∏£‡∏∞‡∏¢‡∏≠‡∏á": { lat: 12.6833, lon: 101.2374 },
    "‡∏£‡∏≤‡∏ä‡∏ö‡∏∏‡∏£‡∏µ": { lat: 13.5282, lon: 99.8134 },
    "‡∏•‡∏û‡∏ö‡∏∏‡∏£‡∏µ": { lat: 14.7995, lon: 100.6533 },
    "‡∏•‡∏≥‡∏õ‡∏≤‡∏á": { lat: 18.2888, lon: 99.4908 },
    "‡∏•‡∏≥‡∏û‡∏π‡∏ô": { lat: 18.5744, lon: 99.0087 },
    "‡πÄ‡∏•‡∏¢": { lat: 17.4860, lon: 101.7223 },
    "‡∏®‡∏£‡∏µ‡∏™‡∏∞‡πÄ‡∏Å‡∏©": { lat: 15.1186, lon: 104.3220 },
    "‡∏™‡∏Å‡∏•‡∏ô‡∏Ñ‡∏£": { lat: 17.1545, lon: 104.1348 },
    "‡∏™‡∏á‡∏Ç‡∏•‡∏≤": { lat: 7.1756, lon: 100.6143 },
    "‡∏™‡∏ï‡∏π‡∏•": { lat: 6.6238, lon: 100.0673 },
    "‡∏™‡∏°‡∏∏‡∏ó‡∏£‡∏õ‡∏£‡∏≤‡∏Å‡∏≤‡∏£": { lat: 13.5990, lon: 100.5998 },
    "‡∏™‡∏°‡∏∏‡∏ó‡∏£‡∏™‡∏á‡∏Ñ‡∏£‡∏≤‡∏°": { lat: 13.4098, lon: 100.0022 },
    "‡∏™‡∏°‡∏∏‡∏ó‡∏£‡∏™‡∏≤‡∏Ñ‡∏£": { lat: 13.5475, lon: 100.2744 },
    "‡∏™‡∏£‡∏∞‡πÅ‡∏Å‡πâ‡∏ß": { lat: 13.8240, lon: 102.0645 },
    "‡∏™‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏µ": { lat: 14.5289, lon: 100.9101 },
    "‡∏™‡∏¥‡∏á‡∏´‡πå‡∏ö‡∏∏‡∏£‡∏µ": { lat: 14.8936, lon: 100.3967 },
    "‡∏™‡∏∏‡πÇ‡∏Ç‡∏ó‡∏±‡∏¢": { lat: 17.0055, lon: 99.8263 },
    "‡∏™‡∏∏‡∏û‡∏£‡∏£‡∏ì‡∏ö‡∏∏‡∏£‡∏µ": { lat: 14.4744, lon: 100.1177 },
    "‡∏™‡∏∏‡∏£‡∏≤‡∏©‡∏é‡∏£‡πå‡∏ò‡∏≤‡∏ô‡∏µ": { lat: 9.1382, lon: 99.3217 },
    "‡∏™‡∏∏‡∏£‡∏¥‡∏ô‡∏ó‡∏£‡πå": { lat: 14.8829, lon: 103.4937 },
    "‡∏´‡∏ô‡∏≠‡∏á‡∏Ñ‡∏≤‡∏¢": { lat: 17.8782, lon: 102.7412 },
    "‡∏´‡∏ô‡∏≠‡∏á‡∏ö‡∏±‡∏ß‡∏•‡∏≥‡∏†‡∏π": { lat: 17.2218, lon: 102.4260 },
    "‡∏≠‡πà‡∏≤‡∏á‡∏ó‡∏≠‡∏á": { lat: 14.5896, lom: 100.4550 },
    "‡∏≠‡∏≥‡∏ô‡∏≤‡∏à‡πÄ‡∏à‡∏£‡∏¥‡∏ç": { lat: 15.8656, lon: 104.6257 },
    "‡∏≠‡∏∏‡∏î‡∏£‡∏ò‡∏≤‡∏ô‡∏µ": { lat: 17.4138, lon: 102.7872 },
    "‡∏≠‡∏∏‡∏ï‡∏£‡∏î‡∏¥‡∏ï‡∏ñ‡πå": { lat: 17.6200, lon: 100.0992 },
    "‡∏≠‡∏∏‡∏ó‡∏±‡∏¢‡∏ò‡∏≤‡∏ô‡∏µ": { lat: 15.3835, lon: 100.0245 },
    "‡∏≠‡∏∏‡∏ö‡∏•‡∏£‡∏≤‡∏ä‡∏ò‡∏≤‡∏ô‡∏µ": { lat: 15.2286, lon: 104.8564 },
    "‡∏ö‡∏∂‡∏á‡∏Å‡∏≤‡∏¨": { lat: 18.3609, lon: 103.6464 }
};

    const months = [
    "‡∏°.‡∏Ñ.",
    "‡∏Å.‡∏û.",
    "‡∏°‡∏µ.‡∏Ñ.",
    "‡πÄ‡∏°.‡∏¢.", 
    "‡∏û.‡∏Ñ.", 
    "‡∏°‡∏¥.‡∏¢.",
    "‡∏Å.‡∏Ñ.", 
    "‡∏™.‡∏Ñ.", 
    "‡∏Å.‡∏¢.", 
    "‡∏ï.‡∏Ñ.", 
    "‡∏û.‡∏¢.", 
    "‡∏ò.‡∏Ñ."];

    const select = document.getElementById("provinceSelect");
    for (let p in provinces) {
      let opt = document.createElement("option");
      opt.value = p;
      opt.innerText = p;
      select.appendChild(opt);
    }

    let hourlyData = {};
    let currentSelectedDay = null;

    function getWeather() {
      const province = select.value;
      const { lat, lon } = provinces[province];

      const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&daily=temperature_2m_max,temperature_2m_min,weathercode&hourly=temperature_2m,relativehumidity_2m&timezone=Asia/Bangkok`;

      fetch(url)
        .then(res => res.json())
        .then(data => {
          const dailyDates = data.daily.time;
          const max = data.daily.temperature_2m_max;
          const min = data.daily.temperature_2m_min;

          const hourlyTimes = data.hourly.time;
          const hourlyTemps = data.hourly.temperature_2m;
          const hourlyHumidity = data.hourly.relativehumidity_2m;

          // ‡πÄ‡∏Å‡πá‡∏ö hourly ‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏°‡∏ß‡∏±‡∏ô
          hourlyData = {};
          hourlyTimes.forEach((t, i) => {
            const day = t.split('T')[0];
            if (!hourlyData[day]) hourlyData[day] = [];
            hourlyData[day].push({
              time: t,
              temp: hourlyTemps[i],
              humidity: hourlyHumidity[i]
            });
          });

          // ‡πÅ‡∏™‡∏î‡∏á 7 ‡∏ß‡∏±‡∏ô
          let weekHtml = '';
          dailyDates.forEach((date, idx) => {
            const d = new Date(date);
            const day = d.getDate();
            const month = months[d.getMonth()];
            const dateStr = `${day} ${month}`;
            weekHtml += `<div class="day" id="day-${date}" onclick="showHourly('${date}')">
                    ${dateStr}<br>${max[idx]}/${min[idx]}¬∞C
                </div>`;
          });
          document.getElementById("weekContainer").innerHTML = weekHtml;
          document.getElementById("summaryContainer").innerHTML = "";
          document.getElementById("hourlyContainer").innerHTML = "";
          currentSelectedDay = null;

          // ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
          const today = new Date().toISOString().split('T')[0];
          if (hourlyData[today]) {
            showHourly(today);
          }
        });
    }

    function showHourly(date) {
      if (currentSelectedDay) {
        document.getElementById(`day-${currentSelectedDay}`).classList.remove('selected');
      }
      document.getElementById(`day-${date}`).classList.add('selected');
      currentSelectedDay = date;

      if (!hourlyData[date]) return;

      const now = new Date();
      const currentHour = now.getHours();

      // filter hourly ‡πÉ‡∏´‡πâ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á >= ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô (‡∏ñ‡πâ‡∏≤‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ)
      let filteredHours = hourlyData[date].filter(h => {
        const hHour = new Date(h.time).getHours();
        if (date === now.toISOString().split('T')[0]) {
          return hHour >= currentHour;
        }
        return true; // ‡∏ß‡∏±‡∏ô‡∏≠‡∏∑‡πà‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
      });

      const temps = filteredHours.map(h => h.temp);
      const humidities = filteredHours.map(h => h.humidity ?? 0);
      const avgTemp = Math.round(temps.reduce((a, b) => a + b, 0) / temps.length);
      const avgHumidity = Math.round(humidities.reduce((a, b) => a + b, 0) / humidities.length);

      // emoji
      let weatherEmoji = "üå§";
      if (avgHumidity >= 70) weatherEmoji = "üåß";
      else if (avgTemp <= 20) weatherEmoji = "‚ùÑÔ∏è";
      else if (avgTemp <= 25) weatherEmoji = "‚òÅÔ∏è";
      else if (avgTemp <= 30) weatherEmoji = "üå§";
      else weatherEmoji = "‚òÄÔ∏è";

      document.getElementById("summaryContainer").innerHTML =
        `<div class="summary">${weatherEmoji} ‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢ ${avgTemp}¬∞C | ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô ${avgHumidity}%</div>`;

      // ‡πÅ‡∏™‡∏î‡∏á hourly
      let html = `<h4>‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡∏£‡∏≤‡∏¢‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á (${date})</h4><div class="hourly">`;
      filteredHours.forEach(h => {
        const hour = new Date(h.time).getHours();
        const hourStr = hour.toString().padStart(2, '0') + ":00";
        const humidityText = h.humidity !== undefined ? ` | ${h.humidity}%` : '';
        html += `<div>${hourStr}<br>${h.temp}¬∞C${humidityText}</div>`;
      });
      html += "</div>";
      document.getElementById("hourlyContainer").innerHTML = html;
    }


  </script>

</body>

</html>